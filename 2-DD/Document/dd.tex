\documentclass[11pt,a4paper]{report}

%INPUT of SETTINGS (usepackage, styles, new command,...)
\input{dd_prefs}

%-------------------------------------------------------------------------
%   START DOCUMENT 
%-------------------------------------------------------------------------
\begin{document}

% INPUT OF TITLE PAGE
\input{dd_titlepage}

%-------------------------------------------------------------------------
%   TOC
%-------------------------------------------------------------------------
%\pagestyle{plain}
\pagenumbering{roman}
\thispagestyle{empty}
\tableofcontents
\listoffigures
\cleardoublepage
\pagenumbering{arabic}
\pagestyle{fancy}
%--------------------------------------------------------------------
%  BEGIN TEXT
%--------------------------------------------------------------------
\chapter{Introduction}
\section{Purpose}
Analyzing the system-to-be in a more detailed way, it is possible to better define the functionalities that the system should provide to the users and the employees.\\
The user has the possibility to register to get a personal account on \textit{PowerEnJoy}, which is by the way mandatory to access to all the functionalities provided. A logged-in user can search for an available car within a certain range from his current position or from a given address and, in case, he can pick up the car. Finally, he has the possibility to reserve a chosen car (he can also delete the reservation subsequently if the car won't be used: in this way he is free from fees).\\
Moreover, to promote a more eco-friendly behaviour of the users, the system applies special discounts or extra charges on the cost of the rides according to some different conditions that will be described in the Non Functional Requirements section.\\ 
With regards to the company employees, the system will let them use special functions to retrieve specific information about the cars (e.g.: battery level, internal working status) and their positions. In this way, they can move cars from safe areas to charging areas and vice versa if needed.

\section{Scope}
The system-to-be will interact with three main world entities: \textit{People}, \textit{Physical platform} and \textit{External software services}.
\textit{People} entity includes the clients and all those people who have a relation with the system, such as the employees.
For what concerns the clients, the interaction with the system consists in both the functionalities that the system provides and the events that are triggered by the users. Log-in, reservations of cars, rides, notifications, parking are the main shared phenomena between the clients and the system.\\Employees collaborate with the system in terms of managing the cars: the search of cars, the notification of their states, the parking are the core shared phenomena between the employees and the system.\\
\textit{Physical platform} consists of the physical infrastructure of the world with which the system exchanges information. It includes the cars, the \textit{Safe Areas} and \textit{Charging Areas}.
Unlocking, locking the cars and routes management are the main phenomena that are shared with the system.\\\textit{Safe Areas} and \textit{Charging Areas} come into account when considering the search for the availability of parking lots or of power plugs.\\Finally, \textit{External software services} are the software tools that cooperate with the system-to-be. They can be considered external systems that already exist in the environment. The main ones are the payment system and GPS location system. The first one interacts with \textit{PowerEnJoy} in the reservation and in the payment phases while GPS system helps with all those actions that require information about position (search for a car, notification, parking, reservation).

\section{Definitions, Acronyms and Abbreviations}
\begin{description}
\item[PowerEnJoy]is the name of the system that has to be developed.
\item[System]sometimes called also \textit{system-to-be}, represents the application that will be described and implemented.
In particular, its structure and implementation will be explained in the following documents. People that will use the car-sharing service will interact with it, via some interfaces, in order to complete some operations (e.g.: reservation and renting).
\item[Renting]it is the act of picking-up an available car and of starting to drive.
\item[Ride] the event of picking-up a car, driving through the city and parking it. Every Ride is associated to a single user and to a single car.
\item[Reservation]it is the action of booking an available car.
\item[Car] a car is an electrical vehicle that will be used by a registered user.
\item[Not Registered User] indicates a person who hasn't registered to the system yet; for this reason he can't access to any of the offered function. The only possible action that he can carry out is the registration to get a personal account.
\item[Registered User] interacts with the system to use the sharing service. He has an account (which contains personal information, driving license number and payment data) that must be used to access to the application in order to exploit all the functionalities.
\item[Employee] it's a person who works for the company, whose main task is to plug into the power grid those cars that haven't been plugged in by the users. He is also in charge of taking care of the status of the cars and of moving the vehicles from a safe area to a charging area and vice versa if needed.
\item[Safe Area] indicates a set of parking lots where the users have to leave the car at the end of the rent; the set of the Safe Areas is pre-defined by the system management. These areas are spread all over the city.
\item[Plug] defines the electrical component that physically connects the car to the power grid.
\item[Charging Area] is a special \textit{Safe Area} that also provides a certain number of plugs that connect the cars to the power grid in order to recharge the battery.
\item[Registration] the procedure that an unregistered user has to perform to become a registered user. At the end, the unregistered user will have an account. To complete this operation three different types of data are required: personal information, driving license number and payment info.
\item[Search] this functionality lets the registered user search for available cars within a certain range from his/her current position or from a specified address.
\item[RASD] is the acronym of \textit{Requirements Analysis and Specification Document}
\item[DD] is the acronym of \textit{Design Document}
\end{description}

\section{Reference Documents}
During the writing of this document, the following resources have been taken into account:
\begin{itemize}
	\item Specification Document:
	\begin{itemize}
		\item \textit{Assignments+AA+2016-2017.pdf}
		\item \textit{RASD.pdf}
	\end{itemize}
	\item Example document:
	\begin{itemize}
		\item \textit{Sample Design Deliverable Discussed on Nov. 2.pdf}
	\end{itemize}
	\item Papers on \textit{Green Move Project}
\end{itemize}
\section{Document Structure}
The first chapter recalls the purpose and the scope of the system that has to be developed and in particular of the current document, which focuses on the architecture of \textit{PowerEnJoy}.\\
In the second chapter, which is the core of the \textit{Design Document},
the overall architecture will be presented at various levels of abstraction. After that a brief explanation of the architectural styles and patterns used is provided.\\
The third chapter covers the algorithmic part of the system; some interesting algorithms that will be useful later on in the real implementation are described in pseudocode.\\
The fourth chapter contains the mockups of both the webapp user interfaces and the ad-hoc touch screen embedded into the cars. Along with them, there is a small description.\\
The fifth chapter reports the mapping of the requirements, identified in the \textit{RASD}, with respect to the architecture's component.\\
The sixth and seventh chapters simply refers to the time effort spent in writing the \textit{DD} and the used tools to do it.
\chapter{Architectural Design}
\section{Overview}
%high level components and their interaction
% here you can introduce the high level components of your architecture
%and describe the main interaction between them (no details here. You can say why some components talk to each other, why, if the communication is synchronous or asynchronous, any other info you think is useful at this point).
\section{Component View}
%here you have a refinement of what you have in Section 4.B and identify sub-components. For instance, the diagram in slide 6 could be a diagram showing a  component view
This section focuses on the internal structure of the system-to-be in terms of the sub-components that it will be composed of and their relations.\\Before going into details, it is useful to recall from the Overview section that the deployment of the application is slightly different between the PC/Mobile and the Car platforms. This is reflected in the following component diagram in which the \textit{Device} (i.e. Mobile and PC) and the \textit{Car} nodes are shaped in different ways, hosting different components and different interfaces with the server.\\One one hand, the \textit{Devices} interact with the application through \textit{WebAppAPI}, on the other hand, the \textit{Car} exposes its proper \textit{CarAPI} and deals with the \textit{ServerAPI} to share information with the application running on the server.\\With regard to the Webapp, there are the following components to take into account:
\begin{description}
\item[ViewRender]is the component in charge of managing the viewable part of the application. It has two main roles: firstly, to fetch the user inputs coming from the Device browser (through the \textit{WebAppAPI}) and to pass them to the \textit{Dispatcher}, and secondly to ship the HTML pages that it receives from the other components to the \textit{Device} browser.
\item[Dispatcher] is the item responsible for the sorting of the incoming requests. It scans the type of request that it receives from the \textit{ViewRender} and selects the suitable component that will take care of it.
\item[ReservationManager] is the module designed to manage the reservation requests. It elaborates the data it gets from the \textit{Dispatcher} and it produces an output in terms of an HTML page that it sends to the \textit{ViewRender}. In doing that, it has to communicate with the \textit{Model} component to get information from the Database and eventually to update it. It also exchanges information with the \textit{ServerCommunicationManager} to notify the selected car of the reservation request.
\item[RegistrationManager] handles the registration requests. It is connected to the \textit{Model} in order to update the data on the Database. It also produces an appropriate HTML page and sends it to the \textit{ViewRender}.
\item[StateManager] is the component that takes care of updating the cars state. Thus, it is linked with the \textit{Model} and with the \textit{ServerCommunicationManager}
As the previous Manager components, it produces an HTML page to notify the success of the operation.
\item[LogInManager] deals with the log in requests. It updates the Database thanks to the \textit{Model} component. It produces an HMTL page. \item[MapController] is the component that manages the map that the user and the system can deal with. It makes use of an external \textit{MapService} thanks to the \textit{MapAPI} and it retrieves data (such as the location of the cars or the Safe areas and Charging areas) from the database and updates the \textit{Model} too. It exchanges information with the \textit{ReservationManager} too.
\item[RideManager] is in charge of the rides management. It has both to retrieve data from the car (thanks to the \textit{ServerCommunicationManager} and the \textit{Dispatcher}
and to ship information to it. To do so, it also needs to get info from the \textit{MapController}.\\It is linked to the \textit{RideCostCalculator} and \textit{PaymentManager} components that offers to it the obvious services.
Finally, this component access the Database through the \textit{Model}.
\item[RideCostCalculator] is the specific component that compute the cost of a ride. To perform this operation it needs info from the \textit{RideManager}.
\item[PaymentManager] handles the communication with the external \textit{Payment System}. To do so, it uses the \textit{PaymentAPI}.
\item[ServerCommunicationManager] 
is the specific component of the Webapp that manages the communication with the car. It receives info from the car thanks to the \textit{CarCommunicationManager} through the \textit{ServerAPI} and sends them to the \textit{Dispatcher} to be elaborated. It also delivers info (coming from the \textit{ReservationManager}, the \textit{StateManager} and the \textit{RideManager}) to the car exploiting the \textit{CarAPI}
\item[Model] is the component that is responsible for the data management within the app. It is linked to all the Manager components and it is the bridge between the server on which the app is running and the Database server. A suitable interface is provided by the DBMS, \textit{DBMSAPI}.
\end{description}

With regard to the Car, the following components are designed:
\begin{description}
\item[CarCommunicationManager] handles the data that the car receives from the Webapp and those data that it has do send back. It is linked to the \textit{CentralUnit}.
\item[CentralUnit] manages the info that come from all the sensors within the car and those that it receives from the server. As a consequence, it communicates with the \textit{ScreenManger} to update the data to be displayed on the screen.
\item[ScreenManager] is the component that organize the data received from the \textit{CentralUnit} and display them on the screen panel. It also gets the user input and delivers it to the \textit{CentralUnit}.
\end{description}

\section{Deployment View}
%this is what you have in slide 8, that is, the identification of the artifact that need to be deployed to have the system working
\section{Runtime View}
%may use sequence diagrams to describe the way components interact to accomplish specific tasks typically related to use cases
%this is what you have in slide 9 plus sequence diagrams describing the way components behave in order to accomplish a certain activity
\section{Component interfaces}
%here you define the interfaces of your components, that is, which operations they offer to the external world, their meaning, any input and output parameter (name, possible set of values/type)
\section{Selected Architectural Styles and Patterns}
%explanation (which, why and how) styles/patterns used
\section{Other Design Decisions}
\subsection{ER Diagram}
An important issue in the Design Process is to select the suitable data that the system has to store in the database.This is crucial in the Design Phase because it affects the implementation of all the system functionalities, which rely on these data.The following diagram shows the pieces of information that the database server provides to the application.
\imagebox{../UML/UML_img/ERProject}{ER Diagram}{0}
\noindent The diagram suggests that the system has two types of \textit{Person}: \textit{User} and \textit{Employee}.As already stated in the \textit{RASD} this is done to distinguish the roles and permissions of the two types of actors.\\The system has to store information about the \textit{Ride} such as the time (in order to be able to compute the cost),possible discount or extra charge and the initial and final position so to keep track of the associated \textit{Car}.\\\textit{Cars} are identified by their unique license plate and the system is always updated on their current state, which is one of the shown above.\\The system also records the info of each \textit{Reservation} in terms of the user and the corresponding car.This is clearly not enough to identify in a unique way a reservation, so the attribute Id is used as a key field for it.\\Finally the system stores the data that are necessary to properly represent the \textit{SafeAreas} and the \textit{ChargingAreas}: their position,their id, information about the number of total outlets and the cars that are parked.This piece of information is crucial for some key functionalities of the system, such as the computation of the uniform distribution of cars in the city.

\chapter{Algorithm Design}
%Focus on the definition of the most relevant algorithmic part
\chapter{User Interface Design}
%Provide an overview on how the user interface(s) of your system will look like; if you have included this part in the RASD, you can simply refer to what you have already done, possibly, providing here some extensions if applicable.
\chapter{Requirements Traceability}
%Explain how the requirements you have defined in the RASD map to the design elements that you have defined in this document.
\chapter{Effort Spent}
%In this section you will include information about the number of hours each group member has worked towards the fulfillment of this deadline.
\chapter{References}
\section{Tools}
During the writing of this document, the following application tools have been used:
\begin{itemize}
	\item Star UML, for creating all types of UML models
	\item TeXstudio, for writing the document in \LaTeX
	\item Balsamiq, for creating the mockups of the user interface
	\item draw.io, for drawing the diagrams of the architecture
\end{itemize}
%-------------------------------------------------------------------------
%   END DOCUMENT
%-------------------------------------------------------------------------
\end{document} 